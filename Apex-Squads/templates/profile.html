{% extends "base.html" %}

{% block title %}Player Profile{% endblock %}

{% block content %}
    {% if player %}
        <div class="profile-container" style="background-image: url('{{ legend_image }}');">
            <div class="profile-overlay"> 
                <div class="profile-header">
                    <h2>{{ player.global.name }}</h2>
                    <span class="platform">Platform: {{ player.global.platform }}</span>
                </div>
                <div class="profile-stats">
                    <div class="stat-card">
                        <h3>Level</h3>
                        <p>{{ player.global.level | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Rank</h3>
                        {% if player.global.rank %}
                            <p>{{ player.global.rank.rankName | default('N/A') }}</p> 
                            <img src="{{ player.global.rank.rankImg | default('') }}" alt="Rank Icon" class="rank-icon">
                        {% else %}
                            <p>Unranked</p>
                        {% endif %}
                    </div>
                    <div class="stat-card">
                        <h3>Most Played Legend</h3>
                        {% if player.legends.selected %}
                            <p>{{ player.legends.selected.legend_name | default('N/A') }}</p>
                        {% else %}
                            <p>No legend data available</p>
                        {% endif %}
                    </div>

                    <div class="stat-card">
                        <h3>Total Games Played</h3>
                        <p>{{ player.total.games_played | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Wins</h3>
                        <p>{{ player.total.wins | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Kills</h3>
                        <p>{{ player.total.kills | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Damage</h3>
                        <p>{{ player.total.damage | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Average Damage per Match</h3> 
                        <p>{{ player.total.damage_per_match | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Highest Damage in a Single Match</h3>
                        <p>{{ player.total.highest_damage | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Highest Kills in a Single Match</h3>
                        <p>{{ player.total.highest_kills | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Knockdowns</h3>
                        <p>{{ player.total.knockdowns | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Assists</h3> 
                        <p>{{ player.total.assists | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Teammates Revived</h3> 
                        <p>{{ player.total.teammates_revived | default('N/A') }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Teammates Respawns</h3> 
                        <p>{{ player.total.teammates_respawned | default('N/A') }}</p>
                    </div>
                </div>
                
                <div class="legend-stats-section">
                    <h2>Legend Statistics</h2> 
                    <div class="legend-cards">
                        {% for legend in player.legends.all %}
                            <div class="legend-card">
                                <h3>{{ legend.legend_name | default('N/A') }}</h3>
                                {% if legend.data %}
                                    {% for stat in legend.data %}
                                        <p><strong>{{ stat.name | default('N/A') }}:</strong> {{ stat.value | default('N/A') }}</p>
                                    {% endfor %}
                                {% else %}
                                    <p>No specific statistics found for this legend.</p> 
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>

                
                {% if session.user %}
                    <form action="{{ url_for('add_to_wishlist') }}" method="post" class="wishlist-form">
                        <input type="hidden" name="item_id" value="{{ player.global.name | default('') }}">
                        <button type="submit">Add to Wishlist</button> 
                    </form>
                {% endif %}
            </div> 
        </div> 
    {% else %}
        <div class="error-container">
            <h2>Player not found or an error occurred.</h2> 
            <p>Please check the player name and platform and try again.</p> 
            <p>Please ensure your API key is correctly configured.</p> 
        </div>
    {% endif %}
{% endblock %}